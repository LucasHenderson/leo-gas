<div class="clientes-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">Clientes</h1>
        <p class="page-subtitle">Gerencie sua base de clientes</p>
      </div>
      
      <div class="header-actions">
        <button class="btn-primary" (click)="openCreateModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Novo Cliente
        </button>
      </div>
    </div>

    <!-- Card de Total -->
    <div class="stats-card">
      <div class="stat-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ totalClientes() }}</span>
        <span class="stat-label">Clientes Cadastrados</span>
      </div>
    </div>

    <!-- Barra de Busca e Filtros -->
    <div class="filters-bar">
      <div class="search-box">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Buscar por nome ou telefone..."
          [value]="searchTerm()"
          (input)="updateSearch($event)"
        >
        @if (searchTerm()) {
          <button class="clear-search" (click)="clearSearch()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        }
      </div>

      <div class="filter-buttons">
        <div class="sort-dropdown">
          <button class="btn-filter">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 16 4 4 4-4"/>
              <path d="M7 20V4"/>
              <path d="m21 8-4-4-4 4"/>
              <path d="M17 4v16"/>
            </svg>
            Ordenar
          </button>
          <div class="sort-options">
            <button (click)="changeSortOrder('nenhum')" [class.active]="sortOrder() === 'nenhum'">
              Sem ordenação
            </button>
            <button (click)="changeSortOrder('nome-asc')" [class.active]="sortOrder() === 'nome-asc'">
              Nome (A-Z)
            </button>
            <button (click)="changeSortOrder('nome-desc')" [class.active]="sortOrder() === 'nome-desc'">
              Nome (Z-A)
            </button>
            <button (click)="changeSortOrder('recentes')" [class.active]="sortOrder() === 'recentes'">
              Cadastro recente
            </button>
            <button (click)="changeSortOrder('antigos')" [class.active]="sortOrder() === 'antigos'">
              Cadastro antigo
            </button>
            <button (click)="changeSortOrder('sem-compras')" [class.active]="sortOrder() === 'sem-compras'">
              Sem pedidos recentes
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Clientes -->
  <div class="clientes-grid">
    @for (cliente of paginatedClientes(); track cliente.id) {
      <div class="cliente-card" (click)="openViewModal(cliente)">
        <div class="card-header">
          <div class="cliente-avatar">
            @if (cliente.nome) {
              {{ cliente.nome.charAt(0).toUpperCase() }}
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            }
          </div>
          <div class="card-actions-mini">
            <button class="btn-action-mini btn-edit" (click)="openEditModal(cliente, $event)" title="Editar">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
            <button class="btn-action-mini btn-delete" (click)="openDeleteModal(cliente, $event)" title="Excluir">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="card-body">
          <h3 class="cliente-nome">{{ cliente.nome || 'Sem nome' }}</h3>
          
          @if (cliente.telefone) {
            <a [href]="getWhatsAppLink(cliente.telefone)" target="_blank" class="cliente-telefone" (click)="$event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
              </svg>
              {{ cliente.telefone }}
            </a>
          } @else {
            <span class="cliente-telefone sem-telefone">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
              Sem telefone
            </span>
          }

          <div class="cliente-info-row">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <span>Desde {{ formatarData(cliente.dataCadastro) }}</span>
          </div>

          @if (cliente.enderecosIds.length > 0) {
            <div class="cliente-enderecos-preview">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              <span>{{ cliente.enderecosIds.length }} endereço(s)</span>
            </div>
          }

          @if (getUltimaCompra(cliente.id); as ultimaCompra) {
            <div class="ultima-compra">
              <span class="ultima-compra-label">Último pedido:</span>
              <span class="ultima-compra-data">{{ formatarData(ultimaCompra.dataCompra) }}</span>
            </div>
          } @else {
            <div class="ultima-compra sem-compra">
              <span>Nenhum pedido registrado</span>
            </div>
          }
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <h3>Nenhum cliente encontrado</h3>
        <p>Cadastre seu primeiro cliente</p>
      </div>
    }
  </div>

  <!-- Paginação -->
  @if (totalPages() > 1) {
    <div class="pagination">
      <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage() === 1">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
      
      @for (page of pages(); track page) {
        <button class="pagination-btn" [class.active]="currentPage() === page" (click)="goToPage(page)">
          {{ page }}
        </button>
      }
      
      <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>
    </div>
  }

  <!-- Modal Backdrop -->
  @if (modalType()) {
    <div class="modal-backdrop" (click)="closeModal()">
      <div class="modal-content" [class.modal-large]="modalType() === 'view'" (click)="$event.stopPropagation()">
        
        <!-- Modal de Criação/Edição -->
        @if (modalType() === 'create' || modalType() === 'edit') {
          <div class="modal-header">
            <h2 class="modal-title">
              {{ modalType() === 'create' ? 'Novo Cliente' : 'Editar Cliente' }}
            </h2>
            <button class="btn-close" (click)="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>

          @if (textoGerado()) {
            <!-- Tela de sucesso após cadastro -->
            <div class="modal-body success-body">
              <div class="success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              </div>
              <h3 class="success-title">Cliente cadastrado com sucesso!</h3>
              <p class="success-text">Copie a mensagem abaixo para enviar ao cliente:</p>
              
              <div class="texto-gerado">
                <pre>{{ textoGerado() }}</pre>
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" (click)="closeModal()">
                  Fechar
                </button>
                <button type="button" class="btn-primary btn-copy" (click)="copiarTexto(textoGerado())">
                  @if (textoCopiadoFeedback()) {
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    Copiado!
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                    </svg>
                    Copiar Mensagem
                  }
                </button>
              </div>
            </div>
          } @else {
            <!-- Formulário -->
            <form class="modal-form" (ngSubmit)="handleSubmit()">
              <div class="form-group">
                <label for="nome">Nome</label>
                <input 
                  type="text" 
                  id="nome" 
                  class="form-input"
                  [value]="formData().nome"
                  (input)="updateNome($event)"
                  placeholder="Nome do cliente"
                >
              </div>

              <div class="form-group">
                <label for="telefone">Telefone (WhatsApp)</label>
                <input 
                  type="text" 
                  id="telefone" 
                  class="form-input"
                  [value]="formData().telefone"
                  (input)="updateTelefone($event)"
                  placeholder="(63) 99999-9999"
                  maxlength="15"
                >
              </div>

              <div class="form-group">
                <label for="dataCadastro">Data de Cadastro</label>
                <input 
                  type="date" 
                  id="dataCadastro" 
                  class="form-input"
                  [value]="getDateInputValue(formData().dataCadastro)"
                  (change)="updateDataCadastro($event)"
                >
              </div>

              <div class="form-group">
                <label>Endereços</label>
                <div class="vinculo-search-container">
                  <div class="vinculo-search-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="vinculo-search-icon">
                      <circle cx="11" cy="11" r="8"/>
                      <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input 
                      type="text" 
                      class="vinculo-search-input" 
                      placeholder="Buscar endereço..."
                      [value]="enderecoSearchTerm()"
                      (input)="updateEnderecoSearch($event)"
                    >
                    @if (enderecoSearchTerm()) {
                      <button type="button" class="vinculo-clear-search" (click)="clearEnderecoSearch()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="18" y1="6" x2="6" y2="18"/>
                          <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                      </button>
                    }
                  </div>
                  @if (formData().enderecosIds.length > 0) {
                    <span class="vinculo-selected-count">{{ formData().enderecosIds.length }} selecionado(s)</span>
                  }
                </div>
                <div class="enderecos-list">
                  @for (endereco of filteredEnderecosModal().items; track endereco.id) {
                    <label class="endereco-checkbox" [class.is-selected]="formData().enderecosIds.includes(endereco.id)">
                      <input 
                        type="checkbox" 
                        [checked]="formData().enderecosIds.includes(endereco.id)"
                        (change)="toggleEndereco(endereco.id)"
                      >
                      <span class="checkmark"></span>
                      <span class="endereco-text">{{ getEnderecoFormatado(endereco) }}</span>
                    </label>
                  } @empty {
                    <p class="no-enderecos">
                      @if (enderecoSearchTerm()) {
                        Nenhum endereço encontrado para "{{ enderecoSearchTerm() }}"
                      } @else {
                        Nenhum endereço cadastrado
                      }
                    </p>
                  }
                  @if (filteredEnderecosModal().hasMore) {
                    <div class="list-more-info">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                      </svg>
                      <span>Mostrando {{ filteredEnderecosModal().items.length }} de {{ filteredEnderecosModal().totalFiltered }} endereços. Use a busca para encontrar mais.</span>
                    </div>
                  }
                </div>
              </div>

              <div class="form-group">
                <label for="observacoes">Observações</label>
                <textarea 
                  id="observacoes" 
                  class="form-input form-textarea"
                  [value]="formData().observacoes"
                  (input)="updateObservacoes($event)"
                  placeholder="Observações sobre o cliente..."
                  rows="3"
                ></textarea>
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" (click)="closeModal()">
                  Cancelar
                </button>
                <button type="submit" class="btn-primary">
                  {{ modalType() === 'create' ? 'Cadastrar' : 'Salvar' }}
                </button>
              </div>
            </form>
          }
        }

        <!-- Modal de Exclusão -->
        @if (modalType() === 'delete' && selectedCliente()) {
          <div class="modal-header">
            <h2 class="modal-title">Excluir Cliente</h2>
            <button class="btn-close" (click)="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>

          <div class="modal-body">
            <div class="confirmation-icon delete">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
              </svg>
            </div>
            
            <p class="confirmation-text">
              Tem certeza que deseja excluir o cliente 
              <strong>{{ selectedCliente()!.nome || 'Sem nome' }}</strong>?
            </p>
            
            @if (selectedCliente()!.enderecosIds.length > 0) {
              <p class="confirmation-warning">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Este cliente será desvinculado de {{ selectedCliente()!.enderecosIds.length }} endereço(s).
              </p>
            }
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeModal()">
              Cancelar
            </button>
            <button type="button" class="btn-danger" (click)="confirmDelete()">
              Excluir Cliente
            </button>
          </div>
        }

        <!-- Modal de Visualização (Detalhes) -->
        @if (modalType() === 'view' && selectedCliente()) {
          <div class="modal-header">
            <h2 class="modal-title">Detalhes do Cliente</h2>
            <button class="btn-close" (click)="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>

          <div class="modal-body view-body">
            <!-- Informações do Cliente -->
            <div class="view-section">
              <div class="view-avatar">
                @if (selectedCliente()!.nome) {
                  {{ selectedCliente()!.nome.charAt(0).toUpperCase() }}
                } @else {
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                }
              </div>
              <h3 class="view-nome">{{ selectedCliente()!.nome || 'Sem nome' }}</h3>
              
              @if (selectedCliente()!.telefone) {
                <a [href]="getWhatsAppLink(selectedCliente()!.telefone)" target="_blank" class="view-telefone">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                  </svg>
                  {{ selectedCliente()!.telefone }}
                </a>
              }

              <div class="view-info-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Cliente desde {{ formatarData(selectedCliente()!.dataCadastro) }}
              </div>
            </div>

            <!-- Endereços -->
            <div class="view-section">
              <h4 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                Endereços
              </h4>
              @if (selectedCliente()!.enderecosIds.length > 0) {
                <div class="view-enderecos-list">
                  @for (endereco of getEnderecosDoCliente(selectedCliente()!.enderecosIds); track endereco.id) {
                    <div class="view-endereco-item">
                      {{ getEnderecoFormatado(endereco) }}
                    </div>
                  }
                </div>
              } @else {
                <p class="no-data">Nenhum endereço vinculado</p>
              }
            </div>

            <!-- Observações -->
            @if (selectedCliente()!.observacoes) {
              <div class="view-section">
                <h4 class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                  </svg>
                  Observações
                </h4>
                <p class="view-observacoes">{{ selectedCliente()!.observacoes }}</p>
              </div>
            }

            <!-- Histórico de Compras -->
            <div class="view-section">
              <h4 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="21" r="1"/>
                  <circle cx="20" cy="21" r="1"/>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                </svg>
                Histórico de Pedidos
              </h4>
              @if (getHistoricoCliente().length > 0) {
                <div class="historico-list">
                  @for (compra of getHistoricoCliente(); track compra.id) {
                    <div class="historico-item">
                      <div class="historico-produto">
                        <span class="historico-nome">{{ compra.produtoNome }}</span>
                        <span class="historico-qtd">x{{ compra.quantidade }}</span>
                      </div>
                      <div class="historico-detalhes">
                        <span class="historico-valor">R$ {{ compra.valorTotal.toFixed(2).replace('.', ',') }}</span>
                        <span class="historico-pagamento">{{ compra.formaPagamento }}</span>
                        <span class="historico-data">{{ formatarData(compra.dataCompra) }}</span>
                      </div>
                      <div class="historico-endereco">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                          <circle cx="12" cy="10" r="3"/>
                        </svg>
                        {{ compra.enderecoEntrega }}
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <p class="no-data">Nenhum pedido registrado</p>
              }
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeModal()">
              Fechar
            </button>
            <button type="button" class="btn-primary btn-copy" (click)="copiarResumoCliente()">
              @if (textoCopiadoFeedback()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
                Copiado!
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
                Copiar Resumo
              }
            </button>
          </div>
        }
      </div>
    </div>
  }
</div>