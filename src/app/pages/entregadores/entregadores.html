<div class="entregadores-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">Entregadores</h1>
        <p class="page-subtitle">Gerencie sua equipe de entregadores</p>
      </div>
      
      <div class="header-actions">
        <button class="btn-filter" (click)="toggleShowInactive()" [class.active]="showInactive()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
          </svg>
          {{ showInactive() ? 'Todos' : 'Apenas Ativos' }}
        </button>
        
        <button class="btn-primary" (click)="openCreateModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Novo Entregador
        </button>
      </div>
    </div>
  </div>

  <!-- Lista de Entregadores -->
  <div class="entregadores-grid">
    @for (entregador of paginatedEntregadores(); track entregador.id) {
      <div class="entregador-card" [class.inactive]="!entregador.ativo">
        <div class="card-header">
          <div class="identificador-badge">{{ entregador.identificador }}</div>
          <div class="status-badge" [class.active]="entregador.ativo">
            {{ entregador.ativo ? 'Ativo' : 'Inativo' }}
          </div>
        </div>
        
        <div class="card-body">
          <h3 class="entregador-nome">{{ entregador.nomeCompleto }}</h3>
          
          <div class="entregador-info">
            <div class="info-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
              <span>{{ entregador.telefone }}</span>
            </div>
            
            <div class="info-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              <span>Desde {{ entregador.dataCadastro | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="btn-action btn-edit" (click)="openEditModal(entregador)" title="Editar">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </button>
          
          <button class="btn-action btn-toggle" (click)="openDeactivateModal(entregador)" [title]="entregador.ativo ? 'Desativar' : 'Ativar'">
            @if (entregador.ativo) {
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
              </svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            }
          </button>
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <h3>Nenhum entregador encontrado</h3>
        <p>{{ showInactive() ? 'Não há entregadores cadastrados' : 'Não há entregadores ativos' }}</p>
      </div>
    }
  </div>

  <!-- Paginação -->
  @if (totalPages() > 1) {
    <div class="pagination">
      <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage() === 1">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
      
      @for (page of pages(); track page) {
        <button class="pagination-btn" [class.active]="currentPage() === page" (click)="goToPage(page)">
          {{ page }}
        </button>
      }
      
      <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </button>
    </div>
  }

  <!-- Modal Backdrop -->
  @if (modalType()) {
    <div class="modal-backdrop" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        
        <!-- Modal de Criação/Edição -->
        @if (modalType() === 'create' || modalType() === 'edit') {
          <div class="modal-header">
            <h2 class="modal-title">
              {{ modalType() === 'create' ? 'Novo Entregador' : 'Editar Entregador' }}
            </h2>
            <button class="btn-close" (click)="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>

          <form class="modal-form" (ngSubmit)="handleSubmit()">
            <div class="form-group">
            <label for="nomeCompleto">Nome Completo *</label>
            <input 
                type="text" 
                id="nomeCompleto" 
                class="form-input"
                [class.error]="formErrors().nomeCompleto"
                [(ngModel)]="formData().nomeCompleto"
                name="nomeCompleto"
                placeholder="Digite o nome completo"
                required
            >
            @if (formErrors().nomeCompleto) {
                <span class="error-message">{{ formErrors().nomeCompleto }}</span>
            }
            </div>

            <div class="form-group">
              <label for="telefone">Telefone *</label>
              <input 
                type="text" 
                id="telefone" 
                class="form-input"
                [class.error]="formErrors().telefone"
                [value]="formData().telefone"
                (input)="applyPhoneMask($event)"
                name="telefone"
                placeholder="(99)99999-9999"
                maxlength="14"
                required
              >
              @if (formErrors().telefone) {
                <span class="error-message">{{ formErrors().telefone }}</span>
              }
            </div>

            <div class="form-group">
              <label for="identificador">Identificador *</label>
              <input 
                type="text" 
                id="identificador" 
                class="form-input identificador-input"
                [class.error]="formErrors().identificador"
                [value]="formData().identificador"
                (input)="formatIdentificador($event)"
                name="identificador"
                placeholder="Ex: ABC"
                maxlength="3"
                required
              >
              <span class="input-hint">Até 3 letras para identificar o entregador</span>
              @if (formErrors().identificador) {
                <span class="error-message">{{ formErrors().identificador }}</span>
              }
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" (click)="closeModal()">
                Cancelar
              </button>
              <button type="submit" class="btn-primary">
                {{ modalType() === 'create' ? 'Cadastrar' : 'Salvar' }}
              </button>
            </div>
          </form>
        }

        <!-- Modal de Desativação -->
        @if (modalType() === 'deactivate' && selectedEntregador()) {
          <div class="modal-header">
            <h2 class="modal-title">
              {{ selectedEntregador()!.ativo ? 'Desativar' : 'Ativar' }} Entregador
            </h2>
            <button class="btn-close" (click)="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>

          <div class="modal-body">
            <div class="confirmation-icon">
              @if (selectedEntregador()!.ativo) {
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              }
            </div>
            
            <p class="confirmation-text">
              Tem certeza que deseja {{ selectedEntregador()!.ativo ? 'desativar' : 'ativar' }} o entregador 
              <strong>{{ selectedEntregador()!.nomeCompleto }}</strong>?
            </p>
            
            @if (selectedEntregador()!.ativo) {
              <p class="confirmation-warning">
                Entregadores desativados não aparecerão nas listagens por padrão.
              </p>
            }
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" (click)="closeModal()">
              Cancelar
            </button>
            <button type="button" class="btn-danger" (click)="confirmDeactivate()">
              {{ selectedEntregador()!.ativo ? 'Desativar' : 'Ativar' }}
            </button>
          </div>
        }
      </div>
    </div>
  }
</div>